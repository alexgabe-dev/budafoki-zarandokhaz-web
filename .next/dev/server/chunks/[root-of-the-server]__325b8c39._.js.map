{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/gbrs/Documents/git-projects/budafoki-zarandokhaz-web/app/api/exhibitions/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\"\nimport fs from \"node:fs\"\nimport path from \"node:path\"\n\nconst EXH_PATH = path.join(process.cwd(), \"lib\", \"gallery-data.tsx\")\nexport const runtime = \"nodejs\"\nexport const dynamic = \"force-dynamic\"\n\nfunction loadExhibitions(): any[] {\n  try {\n    const src = fs.readFileSync(EXH_PATH, \"utf8\")\n    const start = src.indexOf(\"export const allExhibitions\")\n    if (start === -1) return []\n    const bracketStart = src.indexOf(\"[\", start)\n    const sentinel = \"]\\n\\nexport function getExhibition\"\n    const endIdx = src.indexOf(sentinel, bracketStart)\n    if (bracketStart === -1 || endIdx === -1) return []\n    const arrayStr = src.slice(bracketStart, endIdx)\n    // eslint-disable-next-line no-new-func\n    const fn = new Function(\"return \" + arrayStr)\n    const arr = fn()\n    return Array.isArray(arr) ? arr : []\n  } catch {\n    return []\n  }\n}\n\nfunction buildFileContent(items: any[]): string {\n  const header = `export interface ExhibitionDetail {\\n  paintedWhen: string\\n  paintedWhere: string\\n  technique: string\\n  dimensions: string\\n  curatorNote: string\\n}\\n\\nexport interface Exhibition {\\n  id: number\\n  slug: string\\n  title: string\\n  artist: string\\n  description: string\\n  image: string\\n  dateRange: string\\n  location: string\\n  status: \\\"current\\\" | \\\"upcoming\\\"\\n  details?: ExhibitionDetail\\n}\\n\\nexport const allExhibitions: Exhibition[] = [\\n`\n  const entries = items\n    .map((e) => {\n      const details = e.details\n        ? `details: {\\n      paintedWhen: ${JSON.stringify(details.paintedWhen)},\\n      paintedWhere: ${JSON.stringify(details.paintedWhere)},\\n      technique: ${JSON.stringify(details.technique)},\\n      dimensions: ${JSON.stringify(details.dimensions)},\\n      curatorNote: ${JSON.stringify(details.curatorNote)},\\n    },\\n`\n        : \"\"\n      return `  {\\n    id: ${e.id},\\n    slug: ${JSON.stringify(e.slug)},\\n    title: ${JSON.stringify(e.title)},\\n    artist: ${JSON.stringify(e.artist)},\\n    description: ${JSON.stringify(e.description)},\\n    image: ${JSON.stringify(e.image)},\\n    dateRange: ${JSON.stringify(e.dateRange)},\\n    location: ${JSON.stringify(e.location)},\\n    status: ${JSON.stringify(e.status)},\\n    ${details}}\\n`\n    })\n    .join(\"\")\n  const footer = `]\\n\\nexport function getExhibition(slug: string): Exhibition | undefined {\\n  return allExhibitions.find((e) => e.slug === slug)\\n}\\n`\n  return header + entries + footer\n}\n\nfunction slugify(input: string): string {\n  return input\n    .toLowerCase()\n    .replace(/[^a-z0-9áéíóöőúüű\\s-]/g, \"\")\n    .replace(/\\s+/g, \"-\")\n    .replace(/-+/g, \"-\")\n}\n\nexport async function GET() {\n  const arr = loadExhibitions()\n  if (arr.length === 0) {\n    try {\n      const mod = await import(\"@/lib/gallery-data\")\n      return Response.json(mod.allExhibitions ?? [])\n    } catch {\n      return Response.json([])\n    }\n  }\n  return Response.json(arr)\n}\n\nexport async function POST(req: NextRequest) {\n  const isAdmin = req.cookies.get(\"admin\")?.value === \"1\"\n  if (!isAdmin) return new Response(\"Unauthorized\", { status: 401 })\n  const body = await req.json()\n  let items = loadExhibitions().slice()\n  if (!items.length) {\n    try {\n      const mod = await import(\"@/lib/gallery-data\")\n      items = (mod.allExhibitions ?? []).slice()\n    } catch {\n      items = []\n    }\n  }\n  const nextId = items.length ? Math.max(...items.map((i) => i.id)) + 1 : 1\n  const slug = body.slug ? String(body.slug) : slugify(String(body.title))\n  const newItem = {\n    id: nextId,\n    slug,\n    title: String(body.title || \"Untitled\"),\n    artist: String(body.artist || \"\"),\n    description: String(body.description || \"\"),\n    image: String(body.image || \"/placeholder.svg\"),\n    dateRange: String(body.dateRange || \"\"),\n    location: String(body.location || \"\"),\n    status: body.status === \"current\" ? \"current\" : \"upcoming\",\n    details: body.details || undefined,\n  }\n  const content = buildFileContent([newItem, ...items])\n  fs.writeFileSync(EXH_PATH, content, \"utf8\")\n  return Response.json({ ok: true, item: newItem })\n}\n"],"names":[],"mappings":"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"}}]
}