{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/gbrs/Documents/git-projects/budafoki-zarandokhaz-web/app/api/news/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\"\nimport fs from \"node:fs\"\nimport path from \"node:path\"\n\nconst NEWS_PATH = path.join(process.cwd(), \"lib\", \"news-data.tsx\")\nexport const runtime = \"nodejs\"\nexport const dynamic = \"force-dynamic\"\n\nfunction loadArticles(): NewsArticle[] {\n  try {\n    const src = fs.readFileSync(NEWS_PATH, \"utf8\")\n    const start = src.indexOf(\"export const allNews\")\n    if (start === -1) return []\n    const bracketStart = src.indexOf(\"[\", start)\n    const sentinel = \"]\\n\\nexport function getNewsArticle\"\n    const endIdx = src.indexOf(sentinel, bracketStart)\n    if (bracketStart === -1 || endIdx === -1) return []\n    const arrayStr = src.slice(bracketStart, endIdx)\n    // eslint-disable-next-line no-new-func\n    const fn = new Function(\"return \" + arrayStr)\n    const arr = fn()\n    return Array.isArray(arr) ? (arr as NewsArticle[]) : []\n  } catch {\n    return []\n  }\n}\nimport type { NewsArticle } from \"@/lib/news-data\"\n\nfunction buildNewsFileContent(articles: NewsArticle[]): string {\n  const header = `export interface NewsArticle {\\n  id: number\\n  slug: string\\n  title: string\\n  excerpt: string\\n  content: string\\n  date: string\\n  readTime: string\\n  image: string\\n  category: string\\n  featured?: boolean\\n  author: string\\n  authorImage: string\\n}\\n\\nexport const allNews: NewsArticle[] = [\\n`\n  const items = articles\n    .map((a) => {\n      return `  {\\n    id: ${a.id},\\n    slug: ${JSON.stringify(a.slug)},\\n    title: ${JSON.stringify(a.title)},\\n    excerpt: ${JSON.stringify(a.excerpt)},\\n    content: ${JSON.stringify(a.content ?? \"\")},\\n    date: ${JSON.stringify(a.date)},\\n    readTime: ${JSON.stringify(a.readTime)},\\n    image: ${JSON.stringify(a.image)},\\n    category: ${JSON.stringify(a.category)},\\n    ${a.featured ? \"featured: true,\\n    \" : \"\"}author: ${JSON.stringify(a.author ?? \"\")},\\n    authorImage: ${JSON.stringify(a.authorImage ?? \"\")},\\n  },\\n`\n    })\n    .join(\"\")\n  const footer = `]\\n\\nexport function getNewsArticle(slug: string): NewsArticle | undefined {\\n  return allNews.find((article) => article.slug === slug)\\n}\\n\\nexport function getRelatedArticles(currentSlug: string, limit = 3): NewsArticle[] {\\n  const current = allNews.find((article) => article.slug === currentSlug)\\n  if (!current) return allNews.slice(0, limit)\\n\\n  return allNews\\n    .filter((article) => article.slug !== currentSlug)\\n    .sort((a, b) => {\\n      if (a.category === current.category && b.category !== current.category) return -1\\n      if (b.category === current.category && a.category !== current.category) return 1\\n      return 0\\n    })\\n    .slice(0, limit)\\n}\\n`\n  return header + items + footer\n}\n\nfunction normalizeContent(raw: string): string {\n  let html = String(raw || \"\")\n  const styles: string[] = []\n  html = html.replace(/<style[\\s\\S]*?>[\\s\\S]*?<\\/style>/gi, (m) => {\n    styles.push(m)\n    return \"\"\n  })\n  html = html.replace(/<!DOCTYPE[\\s\\S]*?>/i, \"\")\n  html = html.replace(/<\\/?html[\\s\\S]*?>/gi, \"\")\n  html = html.replace(/<\\/?head[\\s\\S]*?>/gi, \"\")\n  const bodyMatch = html.match(/<body[^>]*>([\\s\\S]*?)<\\/body>/i)\n  const bodyInner = bodyMatch ? bodyMatch[1] : html.replace(/<\\/?body[^>]*>/gi, \"\")\n  return (styles.join(\"\\n\") + \"\\n\" + bodyInner).trim()\n}\n\nexport async function PUT(\n  req: NextRequest,\n  context: { params: { id: string } | Promise<{ id: string }> },\n) {\n  const isAdmin = req.cookies.get(\"admin\")?.value === \"1\"\n  if (!isAdmin) return new Response(\"Unauthorized\", { status: 401 })\n  const p: any = await (context as any).params\n  const idParam = p?.id\n  const maybeId = Number(idParam)\n  const body = await req.json()\n  const newsPath = NEWS_PATH\n\n  let articles = loadArticles().slice()\n  if (!articles.length) {\n    try {\n      const mod = await import(\"@/lib/news-data\")\n      articles = (mod.allNews ?? []).slice()\n    } catch {\n      articles = []\n    }\n  }\n  let idx = !Number.isNaN(maybeId) ? articles.findIndex((a) => a.id === maybeId) : -1\n  if (idx === -1 && body?.slug) {\n    idx = articles.findIndex((a) => a.slug === String(body.slug))\n  }\n  if (idx === -1) return new Response(\"Not found\", { status: 404 })\n\n  const target = articles[idx]\n  const updated = { ...target, ...body, id: target.id }\n  // prevent author fields from being reintroduced if omitted\n  updated.author = body.author ?? \"\"\n  updated.authorImage = body.authorImage ?? \"\"\n  updated.content = normalizeContent(String(updated.content || \"\"))\n  if (updated.featured) {\n    for (let i = 0; i < articles.length; i++) {\n      if (i !== idx) {\n        const a = articles[i] as NewsArticle\n        if (a.featured) {\n          articles[i] = { ...a, featured: false }\n        }\n      }\n    }\n  }\n  articles[idx] = updated as NewsArticle\n\n  const content = buildNewsFileContent(articles)\n  fs.writeFileSync(newsPath, content, \"utf8\")\n  return Response.json({ ok: true, article: updated })\n}\n\nexport async function DELETE(\n  req: NextRequest,\n  context: { params: { id: string } | Promise<{ id: string }> },\n) {\n  const isAdmin = req.cookies.get(\"admin\")?.value === \"1\"\n  if (!isAdmin) return new Response(\"Unauthorized\", { status: 401 })\n  const p: any = await (context as any).params\n  const idParam = p?.id\n  const maybeId = Number(idParam)\n  const newsPath = NEWS_PATH\n\n  let articles = loadArticles().slice()\n  if (!articles.length) {\n    try {\n      const mod = await import(\"@/lib/news-data\")\n      articles = (mod.allNews ?? []).slice()\n    } catch {\n      articles = []\n    }\n  }\n  if (!Number.isNaN(maybeId)) {\n    articles = articles.filter((a) => a.id !== maybeId)\n  } else if (typeof idParam === \"string\") {\n    articles = articles.filter((a) => a.slug !== idParam)\n  }\n  const content = buildNewsFileContent(articles)\n  fs.writeFileSync(newsPath, content, \"utf8\")\n  return Response.json({ ok: true })\n}\n"],"names":[],"mappings":"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"}}]
}