{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/gbrs/Documents/git-projects/budafoki-zarandokhaz-web/app/api/news/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\"\nimport fs from \"node:fs\"\nimport path from \"node:path\"\n\nconst NEWS_PATH = path.join(process.cwd(), \"lib\", \"news-data.tsx\")\nexport const runtime = \"nodejs\"\nexport const dynamic = \"force-dynamic\"\n\nfunction loadArticles(): any[] {\n  try {\n    const src = fs.readFileSync(NEWS_PATH, \"utf8\")\n    const start = src.indexOf(\"export const allNews\")\n    if (start === -1) return []\n    const bracketStart = src.indexOf(\"[\", start)\n    const sentinel = \"]\\n\\nexport function getNewsArticle\"\n    const endIdx = src.indexOf(sentinel, bracketStart)\n    if (bracketStart === -1 || endIdx === -1) return []\n    const arrayStr = src.slice(bracketStart, endIdx)\n    // Evaluate the JS array literal safely in a new Function\n    // The file is local and controlled; arrayStr is a pure literal\n    // eslint-disable-next-line no-new-func\n    const fn = new Function(\"return \" + arrayStr)\n    const arr = fn()\n    return Array.isArray(arr) ? arr : []\n  } catch {\n    return []\n  }\n}\n\nfunction buildNewsFileContent(articles: any[]): string {\n  const header = `export interface NewsArticle {\\n  id: number\\n  slug: string\\n  title: string\\n  excerpt: string\\n  content: string\\n  date: string\\n  readTime: string\\n  image: string\\n  category: string\\n  featured?: boolean\\n  author: string\\n  authorImage: string\\n}\\n\\nexport const allNews: NewsArticle[] = [\\n`\n  const items = articles\n    .map((a) => {\n      return `  {\\n    id: ${a.id},\\n    slug: ${JSON.stringify(a.slug)},\\n    title: ${JSON.stringify(a.title)},\\n    excerpt: ${JSON.stringify(a.excerpt)},\\n    content: ${JSON.stringify(a.content ?? \"\")},\\n    date: ${JSON.stringify(a.date)},\\n    readTime: ${JSON.stringify(a.readTime)},\\n    image: ${JSON.stringify(a.image)},\\n    category: ${JSON.stringify(a.category)},\\n    ${a.featured ? \"featured: true,\\n    \" : \"\"}author: ${JSON.stringify(a.author ?? \"\")},\\n    authorImage: ${JSON.stringify(a.authorImage ?? \"\")},\\n  },\\n`\n    })\n    .join(\"\")\n  const footer = `]\\n\\nexport function getNewsArticle(slug: string): NewsArticle | undefined {\\n  return allNews.find((article) => article.slug === slug)\\n}\\n\\nexport function getRelatedArticles(currentSlug: string, limit = 3): NewsArticle[] {\\n  const current = allNews.find((article) => article.slug === currentSlug)\\n  if (!current) return allNews.slice(0, limit)\\n\\n  return allNews\\n    .filter((article) => article.slug !== currentSlug)\\n    .sort((a, b) => {\\n      if (a.category === current.category && b.category !== current.category) return -1\\n      if (b.category === current.category && a.category !== current.category) return 1\\n      return 0\\n    })\\n    .slice(0, limit)\\n}\\n`\n  return header + items + footer\n}\n\nfunction slugify(input: string): string {\n  return input\n    .toLowerCase()\n    .replace(/[^a-z0-9áéíóöőúüű\\s-]/g, \"\")\n    .replace(/\\s+/g, \"-\")\n    .replace(/-+/g, \"-\")\n}\n\nexport async function GET() {\n  const arr = loadArticles()\n  if (arr.length === 0) {\n    try {\n      const mod = await import(\"@/lib/news-data\")\n      return Response.json(mod.allNews ?? [])\n    } catch {\n      return Response.json([])\n    }\n  }\n  return Response.json(arr)\n}\n\nexport async function POST(req: NextRequest) {\n  const isAdmin = req.cookies.get(\"admin\")?.value === \"1\"\n  if (!isAdmin) return new Response(\"Unauthorized\", { status: 401 })\n  const body = await req.json()\n  const newsPath = NEWS_PATH\n\n  let articles = loadArticles().slice()\n  if (!articles.length) {\n    try {\n      const mod = await import(\"@/lib/news-data\")\n      articles = (mod.allNews ?? []).slice()\n    } catch {\n      articles = []\n    }\n  }\n  const nextId = articles.length ? Math.max(...articles.map((a) => a.id)) + 1 : 1\n  const slug = body.slug ? String(body.slug) : slugify(String(body.title))\n\n  const newArticle = {\n    id: nextId,\n    slug,\n    title: String(body.title || \"Untitled\"),\n    excerpt: String(body.excerpt || \"\"),\n    content: normalizeContent(String(body.content || \"\")),\n    date: String(body.date || new Date().toLocaleDateString(\"hu-HU\", { year: \"numeric\", month: \"long\", day: \"numeric\" })),\n    readTime: String(body.readTime || \"2 perc\"),\n    image: String(body.image || \"/placeholder.svg\"),\n    category: String(body.category || \"Esemény\"),\n    featured: Boolean(body.featured) || false,\n    author: \"\",\n    authorImage: \"\",\n  }\n\n  if (newArticle.featured) {\n    for (let i = 0; i < articles.length; i++) {\n      const a = articles[i]\n      if (a.featured) {\n        articles[i] = { ...a, featured: false }\n      }\n    }\n  }\n  articles.unshift(newArticle)\n  const content = buildNewsFileContent(articles)\n  fs.writeFileSync(newsPath, content, \"utf8\")\n  return Response.json({ ok: true, article: newArticle })\n}\nfunction normalizeContent(raw: string): string {\n  let html = String(raw || \"\")\n  // Extract styles to keep custom styling\n  const styles: string[] = []\n  html = html.replace(/<style[\\s\\S]*?>[\\s\\S]*?<\\/style>/gi, (m) => {\n    styles.push(m)\n    return \"\"\n  })\n  // Strip document wrappers\n  html = html.replace(/<!DOCTYPE[\\s\\S]*?>/i, \"\")\n  html = html.replace(/<\\/?html[\\s\\S]*?>/gi, \"\")\n  html = html.replace(/<\\/?head[\\s\\S]*?>/gi, \"\")\n  const bodyMatch = html.match(/<body[^>]*>([\\s\\S]*?)<\\/body>/i)\n  const bodyInner = bodyMatch ? bodyMatch[1] : html.replace(/<\\/?body[^>]*>/gi, \"\")\n  return (styles.join(\"\\n\") + \"\\n\" + bodyInner).trim()\n}\n"],"names":[],"mappings":"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"}}]
}